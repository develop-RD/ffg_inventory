{% extends "base.html" %}

{% block content %}
<div class="upload-container">
    <h1>Редактирование профиля</h1>
    <form method="POST" class="upload-form">
        <div class="form-group">
            <label>Имя пользователя (логин):</label>
            <input type="text" value="{{ current_user.username }}" disabled class="form-control">
        </div>
        
        <div class="form-group">
            <label>Ваше реальное имя:</label>
            <input type="text" name="real_name" value="{{ current_user.real_name or '' }}" class="form-control">
        </div>
        
        <div class="form-group">
            <label>Возраст:</label>
            <input type="number" name="age" value="{{ current_user.age or '' }}" min="1" max="120" class="form-control">
        </div>
        
        <h3>Владение оружием</h3>
        {% for weapon in weapon_data %}
        <div class="weapon-section form-group">
            <div class="checkbox-group">
                <input type="checkbox" id="has_{{ weapon.field }}" name="has_{{ weapon.field }}" 
                      {% if weapon.has %}checked{% endif %} class="weapon-checkbox">
                <label for="has_{{ weapon.field }}"> {{ weapon.name }}</label>
            </div>
            
            <div class="since-date {% if not weapon.has %}hidden{% endif %}">
                <label>Дата начала занятий:</label>
                <input type="date" name="{{ weapon.field }}_since" 
                      value="{{ weapon.since.strftime('%Y-%m-%d') if weapon.since else '' }}" class="form-control">
                {% if weapon.experience %}
                <div class="experience-info">
                    Стаж: {{ weapon.experience.years }} лет и {{ weapon.experience.months }} месяцев
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
            <a href="{{ url_for('view_profile', username=current_user.username) }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Показываем/скрываем поле даты при изменении чекбокса
    $('.weapon-checkbox').change(function() {
        const sinceDiv = $(this).closest('.weapon-section').find('.since-date');
        sinceDiv.toggleClass('hidden', !this.checked);
        
        // Если чекбокс отмечен и поле даты пустое, устанавливаем текущую дату
        if (this.checked && sinceDiv.find('input[type="date"]').val() === '') {
            const today = new Date();
            const formattedDate = today.toISOString().substr(0, 10);
            sinceDiv.find('input[type="date"]').val(formattedDate);
        }
    });
    
    // При загрузке страницы инициализируем видимость полей даты
    $('.weapon-checkbox').each(function() {
        const sinceDiv = $(this).closest('.weapon-section').find('.since-date');
        sinceDiv.toggleClass('hidden', !this.checked);
    });
});
</script>
{% endblock %}
