[file name]: battles.html
[file content begin]
{% extends "base.html" %}

{% block title %}Бои{% endblock %}

{% block content %}
<div class="battles-container">
    <h1>Ближайшие бои</h1>
    
    <div class="battle-date">
        <h2>Ближайшее воскресенье: {{ next_sunday.strftime('%d.%m.%Y') }}</h2>
    </div>
    
    <!-- Блок вызовов -->
    <div class="challenges-section">
        <h3>Мои вызовы</h3>
        
        <!-- Полученные вызовы -->
        {% set received_challenges = current_user.challenges_received|selectattr('battle_date', 'equalto', next_sunday) %}
        {% if received_challenges %}
        <div class="challenges-received">
            <h4>Вам бросили вызов:</h4>
            {% for challenge in received_challenges %}
            <div class="challenge-item">
                <span class="challenger">
                    <a href="{{ url_for('view_profile', username=challenge.challenger.username) }}">
                        {{ challenge.challenger.username }}
                    </a>
                </span>
                <span class="challenge-status {{ challenge.status }}">
                    {% if challenge.status == 'pending' %}
                    <form method="POST" action="{{ url_for('accept_challenge', challenge_id=challenge.id) }}" style="display: inline;">
                        <button type="submit" class="btn-accept">Принять</button>
                    </form>
                    <form method="POST" action="{{ url_for('decline_challenge', challenge_id=challenge.id) }}" style="display: inline;">
                        <button type="submit" class="btn-decline">Отклонить</button>
                    </form>
                    {% elif challenge.status == 'accepted' %}
                    <span class="status-accepted">Принят</span>
                    {% else %}
                    <span class="status-declined">Отклонен</span>
                    {% endif %}
                </span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Отправленные вызовы -->
        {% set sent_challenges = current_user.challenges_sent|selectattr('battle_date', 'equalto', next_sunday) %}
        {% if sent_challenges %}
        <div class="challenges-sent">
            <h4>Ваши вызовы:</h4>
            {% for challenge in sent_challenges %}
            <div class="challenge-item">
                <span class="target">
                    <a href="{{ url_for('view_profile', username=challenge.target.username) }}">
                        {{ challenge.target.username }}
                    </a>
                </span>
                <span class="challenge-status {{ challenge.status }}">
                    {% if challenge.status == 'pending' %}
                    <span class="status-pending">Ожидание</span>
                    <form method="POST" action="{{ url_for('cancel_challenge', challenge_id=challenge.id) }}" style="display: inline;">
                        <button type="submit" class="btn-cancel">Отменить</button>
                    </form>
                    {% elif challenge.status == 'accepted' %}
                    <span class="status-accepted">Принят</span>
                    {% else %}
                    <span class="status-declined">Отклонен</span>
                    {% endif %}
                </span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="response-form">
        <h3>Ваше участие:</h3>
        <form method="POST">
            <div class="response-options">
                <label class="response-option">
                    <input type="radio" name="status" value="going" 
                           {% if user_response and user_response.status == 'going' %}checked{% endif %}>
                    <span class="status-indicator going">Иду</span>
                </label>
                
                <label class="response-option">
                    <input type="radio" name="status" value="not_going" 
                           {% if user_response and user_response.status == 'not_going' %}checked{% endif %}>
                    <span class="status-indicator not-going">Не иду</span>
                </label>
                
                <label class="response-option">
                    <input type="radio" name="status" value="maybe" 
                           {% if user_response and user_response.status == 'maybe' %}checked{% endif %}>
                    <span class="status-indicator maybe">Не знаю</span>
                </label>
            </div>
            <button type="submit" class="btn submit-btn">Отправить</button>
        </form>
    </div>
    
    <div class="filters">
        <h3>Фильтр:</h3>
        <div class="filter-options">
            <a href="{{ url_for('battles', filter='all') }}" 
               class="filter-btn {% if filter_status == 'all' %}active{% endif %}">Все</a>
            <a href="{{ url_for('battles', filter='going') }}" 
               class="filter-btn {% if filter_status == 'going' %}active{% endif %}">Идут</a>
            <a href="{{ url_for('battles', filter='not_going') }}" 
               class="filter-btn {% if filter_status == 'not_going' %}active{% endif %}">Не идут</a>
            <a href="{{ url_for('battles', filter='maybe') }}" 
               class="filter-btn {% if filter_status == 'maybe' %}active{% endif %}">Не знают</a>
        </div>
    </div>
    
    <div class="responses-list">
        <h3>Ответы участников ({{ responses|length }}):</h3>
        
        <div class="stats">
            <div class="stat">
                <span class="stat-label">Идут:</span>
                <span class="stat-count going">
                    {{ responses|selectattr('status', 'equalto', 'going')|list|length }}
                </span>
            </div>
            <div class="stat">
                <span class="stat-label">Не идут:</span>
                <span class="stat-count not-going">
                    {{ responses|selectattr('status', 'equalto', 'not_going')|list|length }}
                </span>
            </div>
            <div class="stat">
                <span class="stat-label">Не знают:</span>
                <span class="stat-count maybe">
                    {{ responses|selectattr('status', 'equalto', 'maybe')|list|length }}
                </span>
            </div>
        </div>
        
        <div class="users-list">
            {% for response in responses %}
            <div class="user-response">
                <a href="{{ url_for('view_profile', username=response.user.username) }}" 
                   class="username-link" title="Перейти к профилю">
                    <span class="username">{{ response.user.username }}</span>
                </a>
                
                <!-- Кнопка броска вызова -->
                {% if response.user.id != current_user.id and response.status == 'going' %}
                <form method="POST" action="{{ url_for('challenge_user', username=response.user.username) }}" style="display: inline;">
                    <button type="submit" class="btn-challenge" title="Бросить вызов">⚔️</button>
                </form>
                {% endif %}
                
                <span class="status-badge {{ response.status }}">
                    {% if response.status == 'going' %}Иду
                    {% elif response.status == 'not_going' %}Не иду
                    {% else %}Не знаю
                    {% endif %}
                </span>
                <span class="response-time">{{ response.created_at.strftime('%H:%M') }}</span>
            </div>
            {% else %}
            <p class="no-responses">Пока нет ответов</p>
            {% endfor %}
        </div>
    </div>
</div>

<style>
/* Стили для навигации с бейджами */
.nav-link-with-badge {
    position: relative;
    display: inline-block;
}

.nav-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #f44336;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
    font-weight: bold;
}

/* Стили для раздела вызовов */
.challenges-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.challenges-section h3 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #2196F3;
    padding-bottom: 10px;
}

.challenges-received, .challenges-sent {
    margin-bottom: 15px;
}

.challenges-received h4, .challenges-sent h4 {
    color: #555;
    margin-bottom: 10px;
}

.challenge-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 6px;
    margin-bottom: 8px;
    background-color: #f9f9f9;
}

.challenger a, .target a {
    font-weight: bold;
    text-decoration: none;
    color: #2196F3;
}

.challenger a:hover, .target a:hover {
    text-decoration: underline;
}

.challenge-status {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Стили для кнопок вызовов */
.btn-challenge {
    background: none;
    border: none;
    font-size: 16px;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.btn-challenge:hover {
    background-color: #ffeb3b;
    transform: scale(1.1);
}

.btn-accept, .btn-decline, .btn-cancel {
    padding: 4px 8px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.btn-accept {
    background-color: #4CAF50;
    color: white;
}

.btn-accept:hover {
    background-color: #3e8e41;
}

.btn-decline {
    background-color: #f44336;
    color: white;
}

.btn-decline:hover {
    background-color: #d32f2f;
}

.btn-cancel {
    background-color: #ff9800;
    color: white;
}

.btn-cancel:hover {
    background-color: #f57c00;
}

.status-pending {
    color: #ff9800;
    font-weight: bold;
}

.status-accepted {
    color: #4CAF50;
    font-weight: bold;
}

.status-declined {
    color: #f44336;
    font-weight: bold;
}

/* Остальные стили остаются без изменений */
.battles-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.battle-date {
    background: #f5f5f5;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    text-align: center;
}

.battle-date h2 {
    margin: 0;
    color: #333;
}

.response-form {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.response-options {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.response-option {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.response-option input[type="radio"] {
    margin-right: 5px;
}

.status-indicator {
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    border: 2px solid transparent;
}

.status-indicator.going {
    background-color: #4CAF50;
    color: white;
}

.status-indicator.not-going {
    background-color: #f44336;
    color: white;
}

.status-indicator.maybe {
    background-color: #ff9800;
    color: white;
}

.response-option input[type="radio"]:checked + .status-indicator {
    border-color: #333;
    transform: scale(1.05);
}

.submit-btn {
    background-color: #2196F3;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.submit-btn:hover {
    background-color: #0b7dda;
}

.filters {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.filter-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 8px 16px;
    border: 1px solid #ddd;
    border-radius: 20px;
    text-decoration: none;
    color: #333;
    transition: all 0.3s;
}

.filter-btn.active,
.filter-btn:hover {
    background-color: #2196F3;
    color: white;
    border-color: #2196F3;
}

.responses-list {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.stats {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
}

.stat {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-label {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
}

.stat-count {
    font-size: 18px;
    font-weight: bold;
}

.stat-count.going { color: #4CAF50; }
.stat-count.not-going { color: #f44336; }
.stat-count.maybe { color: #ff9800; }

.users-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.user-response {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 6px;
    transition: background-color 0.2s;
}

.user-response:hover {
    background-color: #f8f9fa;
}

.username-link {
    text-decoration: none;
    color: inherit;
    min-width: 120px;
}

.username {
    font-weight: bold;
    transition: color 0.2s;
}

.username-link:hover .username {
    color: #2196F3;
    text-decoration: underline;
}

.status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    color: white;
}

.status-badge.going { background-color: #4CAF50; }
.status-badge.not-going { background-color: #f44336; }
.status-badge.maybe { background-color: #ff9800; }

.response-time {
    margin-left: auto;
    color: #666;
    font-size: 12px;
}

.no-responses {
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 20px;
}
</style>
{% endblock %}
[file content end]
